CREATE DATABASE product_ordering;

use product_ordering;


/* ---------------------------------------------------- */
/*  Generated by Enterprise Architect Version 13.5 		*/
/*  Created On : 21-oct.-2017 8:43:23 a.m. 				*/
/*  DBMS       : MySql 						*/
/* ---------------------------------------------------- */

SET FOREIGN_KEY_CHECKS=0 
;

/* Drop Tables */

DROP TABLE IF EXISTS `customer` CASCADE
;

DROP TABLE IF EXISTS `order` CASCADE
;

DROP TABLE IF EXISTS `order_detail` CASCADE
;

DROP TABLE IF EXISTS `product` CASCADE
;

DROP TABLE IF EXISTS `product_customer` CASCADE
;

/* Create Tables */

CREATE TABLE `customer`
(
	`customer_id` INT NOT NULL,
	`name` VARCHAR(255) NOT NULL,
	`email` VARCHAR(255) NOT NULL,
	CONSTRAINT `PK_customer` PRIMARY KEY (`customer_id` ASC)
)

;

CREATE TABLE `order`
(
	`order_id` INT NOT NULL AUTO_INCREMENT,
	`customer_id` INT NULL,
	`delivery_address` VARCHAR(250) NULL,
	`creation_date` DATE NOT NULL,
	CONSTRAINT `PK_order` PRIMARY KEY (`order_id` ASC)
)

;

CREATE TABLE `order_detail`
(
	`order_id` INT NOT NULL,
	`product_id` INT NOT NULL,
	`customer_id` INT NOT NULL,
	`product_quantity` INT NOT NULL,
	`order_detail_price` INT NOT NULL,
	CONSTRAINT `PK_order_detail` PRIMARY KEY (`order_id` ASC, `product_id` ASC, `customer_id` ASC)
)

;

CREATE TABLE `product`
(
	`product_id` INT NOT NULL,
	`name` VARCHAR(250) NOT NULL,
	`price` INT NOT NULL,
	`descripcion` VARCHAR(500) NULL,
	CONSTRAINT `PK_product` PRIMARY KEY (`product_id` ASC)
)

;

CREATE TABLE `product_customer`
(
	`product_id` INT NOT NULL,
	`customer_id` INT NOT NULL,
	CONSTRAINT `PK_product_customer` PRIMARY KEY (`customer_id` ASC, `product_id` ASC)
)

;

/* Create Primary Keys, Indexes, Uniques, Checks */

ALTER TABLE `order` 
 ADD INDEX `IXFK_order_customer` (`customer_id` ASC)
;

/* Create Foreign Key Constraints */

ALTER TABLE `order` 
 ADD CONSTRAINT `FK_order_customer`
	FOREIGN KEY (`customer_id`) REFERENCES `customer` (`customer_id`) ON DELETE Restrict ON UPDATE Restrict
;

ALTER TABLE `order_detail` 
 ADD CONSTRAINT `FK_order_detail_order`
	FOREIGN KEY (`order_id`) REFERENCES `order` (`order_id`) ON DELETE Restrict ON UPDATE Restrict
;

ALTER TABLE `order_detail` 
 ADD CONSTRAINT `FK_order_detail_product_customer`
	FOREIGN KEY (`customer_id`, `product_id`) REFERENCES `product_customer` (`customer_id`,`product_id`) ON DELETE Restrict ON UPDATE Restrict
;

ALTER TABLE `product_customer` 
 ADD CONSTRAINT `FK_product_customer_customer`
	FOREIGN KEY (`customer_id`) REFERENCES `customer` (`customer_id`) ON DELETE Restrict ON UPDATE Restrict
;

ALTER TABLE `product_customer` 
 ADD CONSTRAINT `FK_product_customer_product`
	FOREIGN KEY (`product_id`) REFERENCES `product` (`product_id`) ON DELETE Restrict ON UPDATE Restrict
;

SET FOREIGN_KEY_CHECKS=1 
;

#carga de datos
INSERT INTO product_ordering.customer (customer_id,name,email) VALUES (1, 'Juan Martinez', 'jmartinez@prueba.com');
INSERT INTO product_ordering.customer (customer_id,name,email) VALUES (2, 'Wendy Bohorquez', 'wbohorquez@prueba.com');
INSERT INTO product_ordering.customer (customer_id,name,email) VALUES (3, 'Sindy Tellez', 'stellez@prueba.com');


INSERT INTO product_ordering.product (product_id,name,price,descripcion)
VALUES (1, 'Producto 1', 10000, 'Descripcion producto 1');
INSERT INTO product_ordering.product (product_id,name,price,descripcion)
VALUES (2, 'Producto 2', 20000, 'Descripcion producto 2');
INSERT INTO product_ordering.product (product_id,name,price,descripcion)
VALUES (3, 'Producto 3', 30000, 'Descripcion producto 3');
INSERT INTO product_ordering.product (product_id,name,price,descripcion)
VALUES (4, 'Producto 4', 40000, 'Descripcion producto 4');
INSERT INTO product_ordering.product (product_id,name,price,descripcion)
VALUES (5, 'Producto 5', 50000, 'Descripcion producto 5');


INSERT INTO product_ordering.product_customer (product_id,customer_id) VALUES (1, 1);
INSERT INTO product_ordering.product_customer (product_id,customer_id) VALUES (2, 2);
INSERT INTO product_ordering.product_customer (product_id,customer_id) VALUES (3, 3);
INSERT INTO product_ordering.product_customer (product_id,customer_id) VALUES (4, 1);
INSERT INTO product_ordering.product_customer (product_id,customer_id) VALUES (4, 2);
INSERT INTO product_ordering.product_customer (product_id,customer_id) VALUES (5, 2);